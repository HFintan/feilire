<!DOCTYPE html>
<html lang="ga">
<head>
  <meta charset="UTF-8">
  <title>Féilire Imeachtaí</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 2rem;
      line-height: 1.5;
    }

    h1 {
      margin-bottom: 0.5rem;
    }

    .muted {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 1.5rem;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 1rem;
    }

    fieldset {
      border: 1px solid #ddd;
      padding: 0.8rem 1rem;
      min-width: 260px;
    }

    legend {
      font-weight: bold;
    }

    label {
      display: block;
      font-weight: normal;
      margin-bottom: 0.3rem;
    }

    button {
      margin: 1rem 0 2rem 0;
      padding: 0.4rem 0.8rem;
      font-size: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 0.6rem;
      vertical-align: top;
    }

    th {
      background: #f4f4f4;
      text-align: left;
    }

    tr:nth-child(even) {
      background: #fafafa;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>

<h1>Imeachtaí as Gaeilge i nGaillimh</h1>
<p class="muted">
  Taispeántar anseo imeachtaí a cuireadh isteach tríd an bhfoirm agus atá ceadaithe.
</p>

<!-- Filters -->
<div class="filters">

  <!-- Level filter -->
  <fieldset id="levelFilter">
    <legend>Leibhéal Gaeilge</legend>
    <label><input type="checkbox" value="Bonnleibhéal"> Bonnleibhéal</label>
    <label><input type="checkbox" value="Meánleibhéal"> Meánleibhéal</label>
    <label><input type="checkbox" value="Ardleibhéal"> Ardleibhéal</label>
  </fieldset>

  <!-- Age group filter -->
  <fieldset id="ageFilter">
    <legend>Aoisghrúpa</legend>
    <label><input type="checkbox" value="Páistí réamhscoile (le tuismitheoirí/caomhnóirí leo)"> Páistí réamhscoile</label>
    <label><input type="checkbox" value="Páistí bunscoile (le tuismitheoirí/caomhnóirí leo)"> Páistí bunscoile</label>
    <label><input type="checkbox" value="Páistí meánscoile (le tuismitheoirí/caomhnóirí leo)"> Páistí meánscoile</label>
    <label><input type="checkbox" value="Daoine fásta"> Daoine fásta</label>
    <label><input type="checkbox" value="Mic léinn amháin"> Mic léinn amháin</label>
  </fieldset>

</div>

<button id="applyFilter">Scag</button>

<table id="events">
  <thead>
    <tr>
      <th>Teideal</th>
      <th>Dáta</th>
      <th>Am</th>
      <th>Seoladh</th>
      <th>Leibhéal Gaeilge</th>
      <th>Aoisghrúpa</th>
      <th>Fáilte roimh</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vRa8NU6x7B_AZNcibBPSbqucyEX8tTf83ejnLgtHFdaQzqh4bsRNRv38YdMaMMMTaaKQ8pZ8YthEjg5/pub?gid=2075484807&single=true&output=csv";

  let allRows = [];

  fetch(CSV_URL)
    .then(res => res.text())
    .then(csv => {
      Papa.parse(csv, {
        header: true,
        skipEmptyLines: true,
        complete: results => {
          allRows = results.data;
          renderTable(allRows);
        }
      });
    });

  function renderTable(rows, levelFilter = [], ageFilter = []) {
    const tbody = document.querySelector("#events tbody");
    tbody.innerHTML = "";

    rows.forEach(row => {
      try {
        if (!row.Approved || row.Approved.toString().trim().toLowerCase() !== "true") {
          return;
        }

        // Level filtering
        if (levelFilter.length > 0) {
          const levels = (row["Imeacht oiriúnach le haghaidh cén caighdeán Gaeilge?"] || "")
            .split(",")
            .map(s => s.trim());
          if (!levels.some(l => levelFilter.includes(l))) return;
        }

        // Age filtering
        if (ageFilter.length > 0) {
          const ages = (row["Imeacht oiriúnach do cén aoisghrúpa?"] || "")
            .split(",")
            .map(s => s.trim());
          if (!ages.some(a => ageFilter.includes(a))) return;
        }

        const cell = v => (v ?? "");
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${cell(row["Teideal an imeachta"])}</td>
          <td>${cell(row["Dáta an imeachta (MM/LL/BBBB)"])}</td>
          <td>${cell(row["Am an imeachta"])}</td>
          <td>${cell(row["Seoladh an imeachta"])}</td>
          <td>${cell(row["Imeacht oiriúnach le haghaidh cén caighdeán Gaeilge?"])}</td>
          <td>${cell(row["Imeacht oiriúnach do cén aoisghrúpa?"])}</td>
          <td>${cell(row["Fáilte roimh..?"])}</td>
        `;

        tbody.appendChild(tr);
      } catch (e) {
        console.error("Render error:", row, e);
      }
    });
  }

  document.getElementById("applyFilter").addEventListener("click", () => {
    const levelSelected = Array.from(
      document.querySelectorAll("#levelFilter input:checked")
    ).map(cb => cb.value);

    const ageSelected = Array.from(
      document.querySelectorAll("#ageFilter input:checked")
    ).map(cb => cb.value);

    renderTable(allRows, levelSelected, ageSelected);
  });
</script>

</body>
</html>

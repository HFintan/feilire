<!DOCTYPE html>
<html lang="ga">
<head>
  <meta charset="UTF-8">
  <title>F√©ilire Imeachta√≠</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Simple styling -->
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 2rem;
      line-height: 1.5;
    }

    h1 {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }

    select {
      width: 100%;
      max-width: 300px;
      margin-bottom: 1rem;
    }

    button {
      display: block;
      margin-bottom: 2rem;
      padding: 0.4rem 0.8rem;
      font-size: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 0.6rem;
      vertical-align: top;
    }

    th {
      background: #f4f4f4;
      text-align: left;
    }

    tr:nth-child(even) {
      background: #fafafa;
    }

    .muted {
      color: #666;
      font-size: 0.9rem;
    }
  </style>

  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>

<h1>Imeachta√≠ as Gaeilge i nGaillimh</h1>
<p class="muted">
  Taispe√°ntar anseo imeachta√≠ a cuireadh isteach tr√≠d an bhfoirm agus at√° ceadaithe.
</p>

<!-- Level filter -->
<label for="levelFilter">Scag leibh√©al Gaeilge:</label>
<select id="levelFilter" multiple>
  <option value="Bonnleibh√©al">Bonnleibh√©al</option>
  <option value="Me√°nleibh√©al">Me√°nleibh√©al</option>
  <option value="Ardleibh√©al">Ardleibh√©al</option>
</select>
<button id="applyFilter">Scag</button>

<table id="events">
  <thead>
    <tr>
      <th>Teideal</th>
      <th>D√°ta</th>
      <th>Am</th>
      <th>Seoladh</th>
      <th>Leibh√©al Gaeilge</th>
      <th>Aoisghr√∫pa</th>
      <th>F√°ilte roimh</th>
    </tr>
  </thead>
  <tbody>
    <!-- Rows will be inserted here -->
  </tbody>
</table>

<script>
  // üî¥ Paste your published CSV URL here
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRa8NU6x7B_AZNcibBPSbqucyEX8tTf83ejnLgtHFdaQzqh4bsRNRv38YdMaMMMTaaKQ8pZ8YthEjg5/pub?gid=2075484807&single=true&output=csv";

  let allRows = []; // store all CSV rows globally

  // Fetch CSV and parse
  fetch(CSV_URL)
    .then(response => response.text())
    .then(csvText => {
      Papa.parse(csvText, {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          allRows = results.data;
          renderTable(allRows); // initial render
        }
      });
    })
    .catch(err => {
      console.error("CSV load failed:", err);
    });

  // Render table with optional level filter
  function renderTable(rows, levelFilter = []) {
    const tbody = document.querySelector("#events tbody");
    tbody.innerHTML = "";

    rows.forEach(row => {
      try {
        const approved =
          row.Approved &&
          row.Approved.toString().trim().toLowerCase() === "true";

        if (!approved) return;

        // Filter by levels if selected
        if (levelFilter.length > 0) {
          const levels = (row["Imeacht oiri√∫nach le haghaidh c√©n caighde√°n Gaeilge?"] || "")
            .split(",")
            .map(s => s.trim());
          const hasMatch = levels.some(l => levelFilter.includes(l));
          if (!hasMatch) return;
        }

        const tr = document.createElement("tr");
        const cell = v => (v === undefined || v === null ? "" : v);

        tr.innerHTML = `
          <td>${cell(row["Teideal an imeachta"])}</td>
          <td>${cell(row["D√°ta an imeachta (MM/LL/BBBB)"])}</td>
          <td>${cell(row["Am an imeachta"])}</td>
          <td>${cell(row["Seoladh an imeachta"])}</td>
          <td>${cell(row["Imeacht oiri√∫nach le haghaidh c√©n caighde√°n Gaeilge?"])}</td>
          <td>${cell(row["Imeacht oiri√∫nach do c√©n aoisghr√∫pa?"])}</td>
          <td>${cell(row["F√°ilte roimh..?"])}</td>
        `;

        tbody.appendChild(tr);
      } catch (err) {
        console.error("Row render failed:", row, err);
      }
    });
  }

  // Hook up filter button
  document.getElementById("applyFilter").addEventListener("click", () => {
    const select = document.getElementById("levelFilter");
    const selected = Array.from(select.selectedOptions).map(o => o.value);
    renderTable(allRows, selected);
  });
</script>

</body>
</html>
